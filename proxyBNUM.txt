/******************************************************************************
DESCRIPTION : Script de configuration automatique Internet & Proxy - Equipe SIEC
 ******************************************************************************/
function FindProxyForURL(url, host) {
	
	var liste_flux_proxy = new Array;
	
	var proxy_internet_sopra = "alca.proxy.corp.sopra";
	var proxy_intranet_laposte = "10.7.241.125";
	 
	/******************************************************************************
	 ************************* Liste des flux sans proxy **************************
	 ******************************************************************************/
	// Local classique
	liste_flux_proxy["*127.0.0.1*"] = "DIRECT"
	liste_flux_proxy["*localhost*"] = "DIRECT"
	// Applications internes sopra
	liste_flux_proxy["*cerbere.airbus.com*"] = "DIRECT"
	liste_flux_proxy["*ares.caagis-intra.credit-agricole.fr*"] = "DIRECT"
	liste_flux_proxy["*support.sopragroup.com*"] = "DIRECT"
	liste_flux_proxy["*support.sopra.com*"] = "DIRECT"
	liste_flux_proxy["*support.delta-informatique.com*"] = "DIRECT"
	liste_flux_proxy["*.airbus-v.corp*"] = "DIRECT"
	liste_flux_proxy["*212.219.189.154*"] = "DIRECT"
	liste_flux_proxy["*193.60.199.248*"] = "DIRECT"
	liste_flux_proxy["*svn-ext.soprasteria.com*"] = "DIRECT"
	liste_flux_proxy["*pnp.fr.sfr.com*"] = "DIRECT"
	liste_flux_proxy["*spm.sopragroup.com*"] = "DIRECT"
	liste_flux_proxy["*remoteedi.royallondon.com*"] = "DIRECT"
	liste_flux_proxy["*remotewlm.royallondon.com*"] = "DIRECT"
	liste_flux_proxy["*bsextranet.bancsabadell.com*"] = "DIRECT"
	liste_flux_proxy["*83.68.96.99*"] = "DIRECT"
	liste_flux_proxy["*vpnssl-b.gicm.net*"] = "DIRECT"
	liste_flux_proxy["*193.253.198.102*"] = "DIRECT"
	liste_flux_proxy["*ra-web-ws-asip.keynectis.net*"] = "DIRECT"
	liste_flux_proxy["*my.rbs.com*"] = "DIRECT"
	liste_flux_proxy["*nsxen.extranet.sf.intra.laposte.fr*"] = "DIRECT"
	liste_flux_proxy["*timestamp.globalsign.com*"] = "DIRECT"
	
	/******************************************************************************
	 ********************* Liste des flux proxyfiés La Poste **********************
	 ******************************************************************************/
	// Outils
	liste_flux_proxy["www.wac.courrier.intra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["jyraphe.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["cal.courrier.intra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["zelos.courrier.intra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.ged.courrier.intra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["marionet.build.courrier.intra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["rao.net-courrier.extra.laposte.fr"] = "LAPOSTE"; // Pas encore activé

	// BNUM	
	liste_flux_proxy["boutique.uat1.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["boutique.bo.uat1.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["boutique.uat2.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["boutique.bo.uat2.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.int-eboutique2.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.int-eboutique2.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.eboutique-ba.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique-ba.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.eboutique2.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique2.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.eboutique-bb.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique-bb.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.eboutique-ca.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique-ca.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.eboutique-cb.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique-cb.net3-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.eboutique2.net2-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique2.net2-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique-bb.net2-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["back.eboutique-ba.net2-courrier.extra.laposte.fr"] = "LAPOSTE";
	liste_flux_proxy["www.internet.pro.eboutique-ba.net3-courrier.extra.laposte.fr"] = "LAPOSTE"
	liste_flux_proxy["www.internet.int-eboutique2.net3-courrier.extra.laposte.fr"] = "LAPOSTE"
	liste_flux_proxy["integration.compte.laposte.fr"] = "LAPOSTE"
	

	
	
	/******************************************************************************
	 *********************** Filtrage à partir de la liste ************************
	 ******************************************************************************/

	for (flux_proxy in liste_flux_proxy) {
		if (shExpMatch(host,flux_proxy)) {
			if (dnsDomainIs(host,flux_proxy)) {
				if(liste_flux_proxy[flux_proxy] == "DIRECT")
				{
					// alert('Host "'+host+'" match with "'+flux_proxy+'" --> NO PROXY');
					return "DIRECT";
				}
				else if (liste_flux_proxy[flux_proxy] == "LAPOSTE")
				{
					// alert('Host "'+host+'" match with "'+flux_proxy+'" --> PROXY ' + proxy_intranet_laposte + ':8080');
					return "PROXY " + proxy_intranet_laposte + ":8080";
				}
			}
			// alert('Host "'+host+'" found in "'+flux_proxy+'" --> NO PROXY');
			return "DIRECT";
		}
	}
	
	/******************************************************************************
	 ******************** Filtrage des domaines sopra intranet ********************
	 ******************************************************************************/	
	if (!dnsDomainIs(host, ".sopra.com") && (isPlainHostName(host) 
											|| dnsDomainIs(host, ".sopra") 
											|| dnsDomainIs(host, ".intranet") 
											|| dnsDomainIs(host, ".local") 
											|| dnsDomainIs(host, ".mobile") 
											|| isInNet(host, "172.16.0.0", "255.240.0.0") 
											|| isInNet(host, "127.0.0.0", "255.0.0.0") 
											|| isInNet(host, "10.0.0.0", "255.0.0.0")
											|| isInNet(host, "192.168.0.0", "255.255.0.0") 
											|| isInNet(host, "141.143.0.0", "255.255.255.0") 
											|| isInNet(host, "141.143.1.0", "255.255.255.0") 
											|| isInNet(host, "52.22.184.0", "255.255.254.0") 
											|| isInNet(host, "37.61.242.48", "255.255.255.248")
											)
	)
	{
		// alert('Host "'+host+'" match with "sopra intranet" --> NO PROXY');
		return "DIRECT";
	}
	
	/******************************************************************************
	 ********************************* INTERNET ***********************************
	 ******************************************************************************/	
	// alert('Host "'+host+'" no matches --> PROXY ' + proxy_internet_sopra + ':8080');
	return "PROXY " + proxy_internet_sopra + ":8080";
}
